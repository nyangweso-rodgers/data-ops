# dagster_home/dagster.yaml

# ============================================================================
# STORAGE - PostgreSQL
# ============================================================================
run_storage:
  module: dagster_postgres.run_storage
  class: PostgresRunStorage
  config:
    postgres_db:
      username:
        env: DAGSTER_POSTGRES_USER
      password:
        env: DAGSTER_POSTGRES_PASSWORD
      hostname:
        env: DAGSTER_POSTGRES_HOST
      db_name:
        env: DAGSTER_POSTGRES_DB
      port:
        env: DAGSTER_POSTGRES_PORT
      params:
        connect_timeout: 10
        options: "-c search_path=dagster,public"

event_log_storage:
  module: dagster_postgres.event_log
  class: PostgresEventLogStorage
  config:
    postgres_db:
      username:
        env: DAGSTER_POSTGRES_USER
      password:
        env: DAGSTER_POSTGRES_PASSWORD
      hostname:
        env: DAGSTER_POSTGRES_HOST
      db_name:
        env: DAGSTER_POSTGRES_DB
      port:
        env: DAGSTER_POSTGRES_PORT
      params:
        connect_timeout: 10
        options: "-c search_path=dagster,public"

schedule_storage:
  module: dagster_postgres.schedule_storage
  class: PostgresScheduleStorage
  config:
    postgres_db:
      username:
        env: DAGSTER_POSTGRES_USER
      password:
        env: DAGSTER_POSTGRES_PASSWORD
      hostname:
        env: DAGSTER_POSTGRES_HOST
      db_name:
        env: DAGSTER_POSTGRES_DB
      port:
        env: DAGSTER_POSTGRES_PORT
      params:
        connect_timeout: 10
        options: "-c search_path=dagster,public"

# ============================================================================
# RUN COORDINATOR - How runs are launched
# ============================================================================
run_coordinator:
  module: dagster.core.run_coordinator
  class: QueuedRunCoordinator
  config:
    max_concurrent_runs: 10
    tag_concurrency_limits: []
    dequeue_interval_seconds: 1

# ============================================================================
# RUN LAUNCHER (for local: DefaultRunLauncher, for ECS: EcsRunLauncher) - Where code actually executes
# ============================================================================
run_launcher:
  module: dagster.core.launcher
  class: DefaultRunLauncher

# ============================================================================
# COMPUTE LOGS (stored as files, not in Postgres)
# ============================================================================
compute_logs:
  module: dagster.core.storage.local_compute_log_manager
  class: LocalComputeLogManager
  config:
    base_dir: /app/dagster_home/storage/compute_logs

# ============================================================================
# OPTIONAL:  TELEMETRY
# ============================================================================
telemetry:
  enabled: false

# ═════════════════════════════════════════════════════════════════════════════
# RETENTION - How long to keep old data
# ═════════════════════════════════════════════════════════════════════════════
retention:
  schedule:
    purge_after_days: 90 # Keep schedule ticks for 90 days
  sensor:
    purge_after_days: 90 # Keep sensor ticks for 90 days
